var documenterSearchIndex = {"docs":
[{"location":"man/phaser/#Regularized-fit","page":"Regularized fit","title":"Regularized fit","text":"Publication pending. Docs will be added after acceptance.","category":"section"},{"location":"man/WFFW/#Unconstrained-water-fat-mixture","page":"Unconstrained water-fat mixture","title":"Unconstrained water-fat mixture","text":"","category":"section"},{"location":"man/WFFW/#Description","page":"Unconstrained water-fat mixture","title":"Description","text":"We consider a set of Ny complex local signals y_j acquired at  different echo times t_j in an RF-spoiled multi-echo GRE sequence. A water-fat signal model is assumed in the usual manner\n\n  haty_j\n   = \n  bigl(c_w + c_fbeta_jbigr)e_j\n  qquadqquad\n  e_j\n   = \n  e^iomegat_je^-R_2^astt_j\n\nwith the multi-peak fat model given by\n\n  beta_j  = sum_k=1^malpha_ke^iomega_kt_j\n  qquadqquad\n  sum_k=1^malpha_k = 1\n\nThe real-valued amplitudes alpha_k0 and chemical shifts  omega_k are fixed and assumed to be known. \n\nThe variable parameters of this model are therefore given by c_wc_f in mathbbC and  omega R_2^astin mathbbR.\n\nWriting the signal model in vector notation bmy=bmAbmc, leads to the following definition of the  Ny times Nc matrix bmA\n\nA_j1 = e_j qquadtextandqquad A_j2 = beta_j e_j\n\ntogether with the linear coefficient vector bmc = leftc_wc_fright^T.\n\nIn terms of variable projection, specifically the notation bmAleft(bmxright) introduced in VP4Optim,  the elements in the variable vector bmx are given by a  (sub)set subseteq leftomega R_2^astright.\n\nnote: Note\nIn VARPRO, the coefficients c_w and c_f are calculated in closed form (cf. the  intro section in VP4Optim). This means that there is not way to enforce them to have equal phase. But since all alpha_k are assumed to be real and positive, this would be a consistency requirement. For alternative models, seeReal-valued water-fat mixture: Aligns water and fat, but allows for opposite direction\nConstrained water-fat mixture: Full implementation of the constraint","category":"section"},{"location":"man/WFFW/#Type","page":"Unconstrained water-fat mixture","title":"Type","text":"","category":"section"},{"location":"man/WFFW/#Constructor-parameters","page":"Unconstrained water-fat mixture","title":"Constructor parameters","text":"The parameters for the constructor are defined in\n\nIt can be set up with VP4Optim.modpar.","category":"section"},{"location":"man/WFFW/#Constructor","page":"Unconstrained water-fat mixture","title":"Constructor","text":"","category":"section"},{"location":"man/WFFW/#Support-for-[VP4Optim](https://cganter.github.io/VP4Optim.jl/stable/)","page":"Unconstrained water-fat mixture","title":"Support for VP4Optim","text":"All methods are fully implemented.\nPartial derivatives up to second order are provided.","category":"section"},{"location":"man/WFFW/#Specific-API","page":"Unconstrained water-fat mixture","title":"Specific API","text":"note: Note\nThe fat fraction is defined asfracleftc_frightleftc_wright + leftc_frightand returned by fat_fraction.","category":"section"},{"location":"man/WFFW/#B0Map.GREMultiEchoWFFW","page":"Unconstrained water-fat mixture","title":"B0Map.GREMultiEchoWFFW","text":"VP4Optim model\n\nScope\n\nRF spoiled multi-echo GRE sequence\nWater-fat tissue model\n\nSpecifics\n\nWater and fat are not constrained to have equal phase at zero echo time.\nSingle coil only\n\n\n\n\n\n","category":"type"},{"location":"man/WFFW/#B0Map.ModParWFFW","page":"Unconstrained water-fat mixture","title":"B0Map.ModParWFFW","text":"ModParWFFW <: VP4Optim.ModPar{GREMultiEchoWFFW}\n\nParameters to setup an instance of GREMultiEchoWF\n\nFields\n\nts::Vector{Float64}: Echo times [ms]\nB0::Float64: Field strength [T]\nppm_fat::Vector{Float64}: Chemical shift of fat peaks [ppm]\nampl_fat::Vector{Float64}: Relative amplitudes of fat peaks (≥ 0, add up to one)\nprecession::Symbol: Direction of precession ∈ (:clockwise, :counterclockwise)\nx_sym::Vector{Symbol}: Variable parameters\nΔt::Float64: Effective echo spacing (see docs), Δt == 0 means Δt = mean(ΔTE)\n\n\n\n\n\n","category":"type"},{"location":"man/WFFW/#B0Map.GREMultiEchoWFFW-Tuple{B0Map.ModParWFFW}","page":"Unconstrained water-fat mixture","title":"B0Map.GREMultiEchoWFFW","text":"GREMultiEchoWFFW(pars::ModParWFFW)\n\nConstructor \n\nArguments\n\npars::ModParWFFW: Model parameters to instantiate the model. See ModParWFFW.\n\n\n\n\n\n","category":"method"},{"location":"man/GREgeneral/#Multi-echo-GRE","page":"Multi-echo GRE","title":"Multi-echo GRE","text":"","category":"section"},{"location":"man/GREgeneral/#Global-conventions","page":"Multi-echo GRE","title":"Global conventions","text":"note: Note\nIn case of equidistant echos, separated by a constant Delta t, the local off-resonance  frequency omega cannot be uniquely determined from the data, since adding any integer multiple of 2piDelta t to omega does not affect the fit (apart from an unimportant  global phase).The actual implementations of the signal models below actually do no rely on omega, but rather work with the phase varphi = omegacdotDelta t. This makes no difference, apart from that this now restricts the unambiguous phase information to some 2pi interval, say, (-pi pi.For non-equidistant echo times, the periodicity of frequency/phase is no longer valid. The phase definition still reads varphi = omegacdotDelta t, but Delta t is now taken as the average echo spacing by default. For cases, when this choice is not satisfactory, all models allow to overrule this setting by explicitly providing Delta t in the constructor.\n\nnote: Note\nSome informations about the acquired MRI data are not restricted to specific models:B0::Real: Magnetic field strength of the scanner. [T]\nprecession::Symbol: Specifies, which convention about the orientation of precession is assumed in the data. Assuming positive frequencies, such that omega_water  omega_fat (main fat peak)\nprecession == :counterclockwise means a phase evolution propto e^iomega t.\nprecession == :clockwise means a phase evolution propto e^-iomega t.\nChemical shift [ppm] is defined with the following sign convention: With the water peak at 0 ppm, the chemical shift of the main fat peak shall be negative and approximately located at - 3.4 ppm.\n\nnote: Note\nFor water-fax mixtures, the Constrained water-fat mixture VARPRO model should be used.","category":"section"},{"location":"man/GREgeneral/#Abstract-multi-echo-GRE-type","page":"Multi-echo GRE","title":"Abstract multi-echo GRE type","text":"All (concrete) multi-echo GRE types must be subtypes of","category":"section"},{"location":"man/GREgeneral/#Generic-Routines","page":"Multi-echo GRE","title":"Generic Routines","text":"For tissues containing fat, its relative contribution (0 le PDFF le 1) can always  be obtained with","category":"section"},{"location":"man/GREgeneral/#B0Map.AbstractGREMultiEcho","page":"Multi-echo GRE","title":"B0Map.AbstractGREMultiEcho","text":"AbstractGREMultiEcho{Ny,Nx,Nc,T} <: VP4Optim.Model{Ny,Nx,Nc,T}\n\nAbstract supertype of multi-echo GRE sequences\n\nType parameters\n\nNy::Int: Number of acquired data == number(echoes) * number(coils)\nNx::Int: Number of variable parameters x ⊆ {ϕ, R2s, ...} (relevant for optimization)\nNc::Int: Number of linear coefficients (e.g. number of coil elements)\nT::Union{Float64, ComplexF64}: acquired data type\n\n\n\n\n\n","category":"type"},{"location":"man/GREgeneral/#B0Map.nTE-Tuple{B0Map.AbstractGREMultiEcho}","page":"Multi-echo GRE","title":"B0Map.nTE","text":"nTE(::AbstractGREMultiEcho)\n\nReturn number of recorded echoes\n\n\n\n\n\n","category":"method"},{"location":"man/GREgeneral/#B0Map.Δt","page":"Multi-echo GRE","title":"B0Map.Δt","text":"Δt(gre::T) where T <: AbstractGREMultiEcho\n\nReturn the echo spacing Δt.\n\nRemark\n\nDefaults to the mean echo spacing for non-equidistant sampling.\n\n\n\n\n\n","category":"function"},{"location":"man/GREgeneral/#B0Map.max_derivative-Tuple{B0Map.AbstractGREMultiEcho}","page":"Multi-echo GRE","title":"B0Map.max_derivative","text":"max_derivative(::AbstractGREMultiEcho)\n\nReturn max. implemented derivative order.\n\n\n\n\n\n","category":"method"},{"location":"man/GREgeneral/#B0Map.fat_fraction-Tuple{B0Map.AbstractGREMultiEcho}","page":"Multi-echo GRE","title":"B0Map.fat_fraction","text":"fat_fraction(::AbstractGREMultiEcho)\n\nCalculate and return the fat fraction. (if applicable)\n\nRemark\n\nThe precise implementation depends on the concrete subtype of AbstractGREMultiEcho.\nGenerates an error if no such implementation exists.\n\n\n\n\n\n","category":"method"},{"location":"man/WF/#Constrained-water-fat-mixture","page":"Constrained water-fat mixture","title":"Constrained water-fat mixture","text":"Publication pending. Docs will be added after acceptance.","category":"section"},{"location":"man/results/#Get-results","page":"Get results","title":"Get results","text":"","category":"section"},{"location":"man/results/#Fit-estimators","page":"Get results","title":"Fit estimators","text":"note: Note\nEstimators, calculated by local_fit!  are stored in the supplied structure of type FitPar.","category":"section"},{"location":"man/results/#Derived-quantities","page":"Get results","title":"Derived quantities","text":"Based upon these estimators, further model-dependent information can be calculated with the routine","category":"section"},{"location":"man/results/#Predefined-maps","page":"Get results","title":"Predefined maps","text":"For convenience (and partly efficiency) some more direct calls are provided as well:","category":"section"},{"location":"man/results/#B0Map.calc_par","page":"Get results","title":"B0Map.calc_par","text":"calc_par(fitpar::FitPar{T}, fitopt::FitOpt, parfun::Function, res::AbstractArray) where {T<:AbstractGREMultiEcho}\n\nExtract model specific information and store it in array res.\n\nArguments\n\nfitpar::FitPar: Fit parameters\nfitopt::FitOpt: Fit options\nparfun::Function: Used to call parfun(gre::T) for each location in fitpar.S, based upon the local data and fit estimates. \nres::AbstractArray: Allocated space for the results (size(res) == size(fitpar.S)).\n\nExample\n\nff = zeros(size(fitpar.S))                          # allocate space for the results\nBM.calc_par(fitpar, fitopt, BM.fat_fraction, ff)    # do the job\n\n\n\n\n\n","category":"function"},{"location":"man/results/#B0Map.fat_fraction_map","page":"Get results","title":"B0Map.fat_fraction_map","text":"fat_fraction_map(fitpar, fitopt)\n\nReturn the fat fraction map.\n\nArguments\n\nfitpar::FitPar: Fit parameters\nfitopt::FitOpt: Fit options\n\nRemarks\n\nsize(returned map) == size(fitpar.S)\nAvoids the necessity to allocate space.\nRelies on calc_par.\n\nExample\n\nff = BM.fat_fraction_map(fitpar, fitopt)\n\n\n\n\n\n","category":"function"},{"location":"man/results/#B0Map.freq_map","page":"Get results","title":"B0Map.freq_map","text":"freq_map(fitpar)\n\nReturn the frequency map [Hz].\n\nArguments\n\nfitpar::FitPar: Fit parameters\n\nRemarks\n\nsize(returned map) == size(fitpar.S)\nSimply rescales the phase map fitpar.ϕ instead of calling calc_par.\n\nExample\n\nfm = BM.freq_map(fitpar)\n\n\n\n\n\n","category":"function"},{"location":"man/localfit/#Local-fit","page":"Local fit","title":"Local fit","text":"Local B_0 fitting can be done in two ways:\n\nSplitting the interval -pi pi into n_ϕ subintervals of equal size and fitting them separately. The final maximum likelihood (ML) estimator is defined by the minimal chi^2. Use set_num_phase_intervals to define the n_ϕ intervals in fitopt.\nStarting from some initial guess ϕ, search for the closest local minimum of chi^2 with a nonlinear optimizer.","category":"section"},{"location":"man/localfit/#Method","page":"Local fit","title":"Method","text":"Local data fitting is accomplished by the routine","category":"section"},{"location":"man/localfit/#Golden-section-search-(GSS)","page":"Local fit","title":"Golden section search (GSS)","text":"An auxiliary golden section search (GSS) implementation is provided in  ","category":"section"},{"location":"man/localfit/#B0Map.local_fit!","page":"Local fit","title":"B0Map.local_fit!","text":"local_fit!(fitpar::FitPar{T}, fitopt::FitOpt) where {T<:AbstractGREMultiEcho}\n\nFit data to multi-echo GRE model locally.\n\nArguments\n\nfitpar::FitPar: Fit parameters (see FitPar)\nfitopt::FitOpt: Fit options (see FitOpt)\n\nRemarks\n\nFits fitpar.data to all points specified by fitpar.S.\nAfter calling set_num_phase_intervals(fitopt, 0), the golden section search (GSS) fit is only done with respect to R2s, based upon the local phase, specified in fitpar.ϕ.\nAfter calling set_num_phase_intervals(fitopt, n_ϕ), a GSS search with respect to ϕ (for fixed R2s == 0) is performed for all n_ϕ equally sized subintervals. For each of these optimal phases fixed, a subsequent GSS search with respect to R2s follows. The combination [ϕ, R2s], which produces the best fit is selected.\nIf fitopt.optim == true, the best GSS estimate [ϕ, R2s] is refined by a nonlinear fitting.\nThe final estimates [ϕ, R2s] are stored in fitpar, together with the linear coefficients VP4Optim.c and the goodness of fit VP4Optim.χ2.\n\nExample\n\nAfter setting up fitpar and fitopt, as described in Set up parameters:\n\n# call local fit routine\nBM.local_fit!(fitpar, fitopt)\n\n\n\n\n\n","category":"function"},{"location":"man/localfit/#B0Map.GSS","page":"Local fit","title":"B0Map.GSS","text":"GSS(fun::Function, var_rng, acc; show_all=false)\n\nSearch for minimum of given function fun with golden section search (GSS).\n\nArguments\n\nfun::Function: real valued function of a single real valued argument. (Can be a closure.)\nvar_rng::T <: Union{Vector, Tuple}: search interval boundaries, length(var_rng) == 2\nacc::Float64: Required accuracy of location.\nshow_all::Bool: Also return visited locations and their values (default: false)\n\nOutput\n\nshow_all ? (x_opt, fun(x_opt), xs, fs) : (x_opt, fun(x_opt)), where\nx_opt is the location of the minimum with value fun(x_opt)\nxs::Vector{Float64} is the (sorted) vector of all tested locations and fs = map(x -> fun(x), xs)\n\nExample\n\nx_min, f_min = 1, 2\nf = x -> (x - x_min)^2 + f_min\n\nx_opt, f_opt, xs, fs = BM.GSS(f, [0,2], 1e-6; show_all=true)\n\n# x_opt should be close to x_min and f_opt close to f_min.\n# the tested (location, value) pairs can be displayed with lines(xs, fs), for example.\n\n\n\n\n\n","category":"function"},{"location":"man/fittools/#Set-up-parameters","page":"Set up parameters","title":"Set up parameters","text":"","category":"section"},{"location":"man/fittools/#Sequence-and-tissue","page":"Set up parameters","title":"Sequence and tissue","text":"Any available information about the acquisition and tissue, including the data and allocated  arrays for the fit results is stored in a single data structure\n\nTo create an instance, we just call a constructor","category":"section"},{"location":"man/fittools/#Fit-options","page":"Set up parameters","title":"Fit options","text":"All options, affecting the fit routines provided in B0Map, are collected in the structure\n\nTo set them up, we generate an instance with default values, using the constructor\n\nnote: Note\nTo change the default phase search intervals, do not directly change the field fitopt.n_ϕ, but call the following routine:","category":"section"},{"location":"man/fittools/#B0Map.FitPar","page":"Set up parameters","title":"B0Map.FitPar","text":"Data structure for fitting images.\n\nContent\n\ngrePar::VP4Optim.ModPar{AbstractGREMultiEcho}: Specifics of the GRE acquisition and signal/tissue model\ndata::Array: Complex data\nS::Array: Mask to specify ROI\nϕ::Array: Phase phi = omega cdot Delta t (fit parameter)\nR2s::Array: Relaxation rate R_2^ast (fit parameter)\nc::Array: Array of linear VARPRO coefficient vectors bmc(phi R_2^ast)\nχ2::Array: Least squares residual chi^2\n\nScope\n\nLocal and regularized fit\n\n\n\n\n\n","category":"type"},{"location":"man/fittools/#B0Map.fitPar","page":"Set up parameters","title":"B0Map.fitPar","text":"fitPar(grePar::VP.ModPar{T}, data::AbstractArray, S::AbstractArray) where {T <: AbstractGREMultiEcho}\n\nConstructor for FitPar\n\nArguments\n\ngrePar::VP4Optim.ModPar{AbstractGREMultiEcho}: Specifics of the GRE acquisition and signal/tissue model\ndata::AbstractArray: Complex multi-echo (if available also multi-coil) GRE data for each location.\nS::AbstractArray: Mask to specify ROI.\n\nRemarks\n\nsize(S) defines size and spatial dimensions (typically 2 or 3) of the data block.\nMandatory: size(data)[1:ndims(S)] == size(S)\nThe format of data must be such that VP4Optim.setdata!(gre, reshape(data, size(S)..., :)[ci,:]) works for any ci ∈ CartesianIndices(S)\nFor single-coil images, this means ndims(data) == ndims(S) + 1 with the last index enumerating the echoes.\nFor multi-coil data, we typically have ndims(data) == ndims(S) + 2 with the last but one index enumerating echo times and the last index enumerating the coils.\n\nExample\n\nimport VP4Optim as VP\nimport B0Map as BM\n\n# Mandatory acquisition parameters\nnTE = 6                             # number of echoes\nt0 = 0.5                            # first echo time [ms]\nΔTE = 1.0                           # echo spacing [ms]\nTEs = [range(t0, t0 + (nTE-1) * ΔTE, nTE);]  # resulting echo times\nB0 = 3.0                            # scanner field strength [T]\nprecession = :counterclockwise      # orientation of precession (depends on the scanner)\n\n# Optional parameters\nn_coils = 6                         # number of coils (if reconstructed separately)\ncov_mat = get_cov_mat(...)          # coil covariance matrix (if available)\n\n# Define water-fat tissue model (we only need to specify the fat component)\nppm_fat = [-3.80, -3.40, -2.60, -1.94, -0.39, 0.60]\nampl_fat = [0.087, 0.693, 0.128, 0.004, 0.039, 0.048]\n\n# set up model constructor parameters\ngrePar = VP.modpar(BM.ModParWF;\n    ts = TEs,                       # required\n    B0 = B0,                        # required\n    ppm_fat = ppm_fat,              # required\n    ampl_fat = ampl_fat,            # required\n    precession = precession,        # required\n    n_coils = n_coils,              # optional (if ≠ 1)\n    cov_mat = cov_mat,              # optional (if of relevance)\n    )\n    \n# Prepare data and ROI\n# (For the required dimensions, see the docs of the constructor fitPar().)\ndata = get_from_somewhere(...)\nS = define_ROI_somehow(data, ...)\n\n# create an instance of FitPar\nfitpar = BM.fitPar(grePar, data, S) \n\n\n\n\n\n","category":"function"},{"location":"man/fittools/#B0Map.FitOpt","page":"Set up parameters","title":"B0Map.FitOpt","text":"Data structure holding the fit parameters.\n\nLocal Fit and PHASER\n\nn_ϕ::Int: number of golden section search (GSS) intervals for the initial phase search (with R2s == 0).\nϕ_rngs::Array: GSS intervals, associated with n_ϕ.\nΔϕ2::Float64: Half interval for (optional) nonlinear optimization.\nR2s_rng::Array: Search range for R2s.\nϕ_acc::Float64: Required GSS accuracy for ϕ_acc\nR2s_acc::Float64: Required GSS accuracy for R2s_acc\n\nLocal Fit only\n\noptim::Bool: Nonlinear optimiztion in addition to GSS? (Requires gradients to be implemented for the GRE model.)\n\nPHASER only\n\noptim_phaser::Bool: How to treat initial search in PHASER? (cf. optim for details)\nbalance: Max. number of data-based balancing\nrapid_balance: if true, R2s = 0 will be assumed during balancing\nμ_tikh::Float: (Small) Tikhonov regularization parameter\nK::Vector{Int}: Fourier Kernel size\nmulti_scale::Bool: if true, gradient based fitting will start with smooth kernel\nos_fac::Vector{Float64}: oversampling factor\nredundancy::Float64: \nsubsampling::Symbol: subsampling strategy (:fibonacci or :random)\noptim_balance::Bool: Optimization during balancing of local and gradient fit\nlocal_fit::Bool: Perform a final local fit, based upon PHASER.\n\nGeneral\n\nn_chunks::Int: Number of chunks to profit from multi-threaded execution.\naccel::Symbol: Which acceleration technique should be used. Supported values are :mt (multi-threading). (:cuda not implemented yet)\n\nRemark\n\nUse set_num_phase_intervals to modify n_ϕ, since only then ϕ_rngs will be set properly.\n\n\n\n\n\n","category":"type"},{"location":"man/fittools/#B0Map.fitOpt","page":"Set up parameters","title":"B0Map.fitOpt","text":"fitOpt(ϕ_scale = 1.0)\n\nDefault constructor for FitOpt\n\nArgument\n\nϕ_scale::Float64: See set_num_phase_intervals\n\nRemark\n\nTypical use case:\n\nGenerate instance of FitOpt with this constructor.\nModify parameters as needed.\n\nExample\n\n# generate FitOpt instance with default options\nfitopt = BM.fitOpt()\n\n# modify whatever we like to modify\nBM.set_num_phase_intervals(fitpar, fitopt, 4)\nfitopt.ϕ_acc = 1.e-6\n...\n\n\n\n\n\n","category":"function"},{"location":"man/fittools/#B0Map.set_num_phase_intervals","page":"Set up parameters","title":"B0Map.set_num_phase_intervals","text":"set_num_phase_intervals(fitpar, fitopt, n_ϕ)\n\nDefine, how to search minimum of χ².\n\nArguments\n\nfitpar::FitPar: Fit parameters\nfitopt::FitOpt: Fit options\nn_ϕ: Number of search intervals\n\nRemark\n\nn_ϕ > 0: Split [-π, π) into n_ϕ subintervals and store them in fitopt.ϕ_rngs.\nn_ϕ == 0: Clear fitopt.ϕ_rngs for a nonlinear search, starting from fitpar.ϕ\n\n\n\n\n\n","category":"function"},{"location":"#B0Map","page":"Home","title":"B0Map","text":"Tools for rapid B_0 mapping in quantitative magnetic resonance imaging (qMRI).","category":"section"},{"location":"#Scope-and-Features","page":"Home","title":"Scope and Features","text":"Sequence: Multi-echo GRE\nTissue: Water-fat mixture with spectral fat model\nLocal and regularized field maps\nSupport for multiple coil elements (with optional noise covariance)\nMaps: B_0, R_2^ast, proton density fat fraction (PDFF), coil sensitivities\nBased upon the variable projection (VARPRO) package VP4Optim.\nAcceleration: Multi-threading","category":"section"},{"location":"#Installation","page":"Home","title":"Installation","text":"The package is not registered yet. Until then, just clone it and add it to your load path.","category":"section"},{"location":"#Quick-Start","page":"Home","title":"Quick Start","text":"    Pages=[\n        \"man/fittools.md\",\n        \"man/localfit.md\",\n        \"man/phaser.md\",\n        \"man/results.md\",\n        ]\n    Depth=1","category":"section"},{"location":"#Signal-models","page":"Home","title":"Signal models","text":"    Pages=[\n        \"man/GREgeneral.md\",\n        \"man/WFFW.md\",\n        \"man/WFRW.md\",\n        \"man/WF.md\",\n        ]\n    Depth=1","category":"section"},{"location":"#API","page":"Home","title":"API","text":"    Pages=[\n        \"man/api.md\",\n        ]\n    Depth=1","category":"section"},{"location":"man/WFRW/#Real-valued-water-fat-mixture","page":"Real-valued water fat mixture","title":"Real-valued water-fat mixture","text":"","category":"section"},{"location":"man/WFRW/#Description","page":"Real-valued water fat mixture","title":"Description","text":"We consider a set of Ny complex local signals y_j acquired at  different echo times t_j in an RF-spoiled multi-echo GRE sequence. A water-fat signal model is assumed in the usual manner\n\n  haty_j\n   = \n  e^ithetabigl(r_w + r_fbeta_jbigr)e_j\n  qquadqquad\n  e_j\n   = \n  e^iomegat_je^-R_2^astt_j\n\nwith the multi-peak fat model given by\n\n  beta_j  = sum_k=1^malpha_ke^iomega_kt_j\n  qquadqquad\n  sum_k=1^malpha_k = 1\n\nThe real-valued amplitudes alpha_k0 and chemical shifts  omega_k are fixed and assumed to be known. \n\nThe variable parameters of this model are therefore given by r_wr_f in mathbbR and  omega R_2^ast thetain mathbbR.\n\nWriting the signal model in vector notation bmy=bmAbmr, leads to the following definition of the  Ny times Nc matrix bmA\n\nA_j1 = e^ithetae_j qquadtextandqquad A_j2 = e^ithetabeta_je_j\n\ntogether with the real-valued linear coefficient vector bmr = leftr_wr_fright^T.\n\nnote: Note\nNote that the incorporating theta into bmA increases the complexity of the VARPRO  cost function chi^2. As shown by Bydder et al.,  it is possible to determine theta=thetaleft(omegaR_2^astright) efficiently and thereby remove its explicit appearance in chi^2. The model GREMultiEchoWFRW already takes care of this and no user action is needed.\n\nIn terms of variable projection, specifically the notation bmAleft(bmxright) introduced in VP4Optim,  the elements in the variable vector bmx are therefore given by a  (sub)set subseteq leftomega R_2^astright.\n\nnote: Note\nDifferent from Unconstrained water-fat mixture, this model does not allow water and fat to point in arbitrary directions at t=0, but aligns them. This significantly improves stability  in case of noisy data and/or a small number of echo times. While forced to be parallel, water and fat still may point in opposed directions though, which can still cause stability issues for challenging data.An alternative fully constrained model has been developed in [link to follow] and is described in Constrained water-fat mixture.","category":"section"},{"location":"man/WFRW/#Type","page":"Real-valued water fat mixture","title":"Type","text":"","category":"section"},{"location":"man/WFRW/#Constructor-parameters","page":"Real-valued water fat mixture","title":"Constructor parameters","text":"The parameters for the constructor are defined in\n\nIt can be set up with VP4Optim.modpar.","category":"section"},{"location":"man/WFRW/#Constructor","page":"Real-valued water fat mixture","title":"Constructor","text":"","category":"section"},{"location":"man/WFRW/#Support-for-[VP4Optim](https://cganter.github.io/VP4Optim.jl/stable/)","page":"Real-valued water fat mixture","title":"Support for VP4Optim","text":"All methods are fully implemented with one exception:\nNo partial derivatives are implemented.","category":"section"},{"location":"man/WFRW/#Specific-API","page":"Real-valued water fat mixture","title":"Specific API","text":"note: Note\nThe fat fraction is defined asfracleftr_frightleftr_wright + leftr_frightand returned by fat_fraction.","category":"section"},{"location":"man/WFRW/#B0Map.GREMultiEchoWFRW","page":"Real-valued water fat mixture","title":"B0Map.GREMultiEchoWFRW","text":"VP4Optim model\n\nScope\n\nRF spoiled multi-echo GRE sequence\nWater-fat tissue model\n\nSpecifics\n\nWater and fat components are described by real weights, multiplied with a common phase factor.\nSingle coil only.\nNo partial derivatives implemented\n\n\n\n\n\n","category":"type"},{"location":"man/WFRW/#B0Map.ModParWFRW","page":"Real-valued water fat mixture","title":"B0Map.ModParWFRW","text":"ModParWFRW <: VP4Optim.ModPar{GREMultiEchoWFRW}\n\nParameters to setup an instance of GREMultiEchoWF\n\nFields\n\nts::Vector{Float64}: Echo times [ms]\nB0::Float64: Field strength [T]\nppm_fat::Vector{Float64}: Chemical shift of fat peaks [ppm]\nampl_fat::Vector{Float64}: Relative amplitudes of fat peaks (≥ 0, add up to one)\nprecession::Symbol: Direction of precession ∈ (:clockwise, :counterclockwise)\nx_sym::Vector{Symbol}: Variable parameters\nΔt::Float64: Effective echo spacing (see docs), Δt == 0 means Δt = mean(ΔTE)\n\n\n\n\n\n","category":"type"},{"location":"man/WFRW/#B0Map.GREMultiEchoWFRW-Tuple{B0Map.ModParWFRW}","page":"Real-valued water fat mixture","title":"B0Map.GREMultiEchoWFRW","text":"GREMultiEchoWFRW(pars::ModParWFRW)\n\nConstructor \n\nArguments\n\npars::ModParWFRW: Model parameters to instantiate the model. See ModParWFRW.\n\n\n\n\n\n","category":"method"},{"location":"man/WFRW/#B0Map.coil_phase","page":"Real-valued water fat mixture","title":"B0Map.coil_phase","text":"coil_phase(gre::GREMultiEchoWFRW)\n\nReturn (coil) phase theta.\n\n\n\n\n\n","category":"function"},{"location":"man/api/#API","page":"API","title":"API","text":"","category":"section"}]
}
